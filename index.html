<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Code Library v2</title>
    <style>
        :root {
            --bg: #050505;
            --card-bg: #111;
            --neon-green: #00ff66;
            --neon-red: #ff0044;
            --uib-color: var(--neon-green);
        }

        body {
            background: var(--bg);
            color: #eee;
            font-family: 'Segoe UI', sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- ЛОАДЕР --- */
        #loader-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: var(--bg); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }

        .three-body {
            --uib-size: 45px; --uib-speed: 0.8s;
            position: relative; display: inline-block; height: var(--uib-size); width: var(--uib-size);
            animation: spin78236 calc(var(--uib-speed) * 2.5) infinite linear;
        }
        .three-body__dot { position: absolute; height: 100%; width: 30%; }
        .three-body__dot:after {
            content: ''; position: absolute; height: 0%; width: 100%; padding-bottom: 100%;
            background-color: var(--uib-color); border-radius: 50%;
        }
        .three-body__dot:nth-child(1) { bottom: 5%; left: 0; transform: rotate(60deg); transform-origin: 50% 85%; }
        .three-body__dot:nth-child(1)::after { bottom: 0; left: 0; animation: wobble1 var(--uib-speed) infinite ease-in-out; animation-delay: calc(var(--uib-speed) * -0.3); }
        .three-body__dot:nth-child(2) { bottom: 5%; right: 0; transform: rotate(-60deg); transform-origin: 50% 85%; }
        .three-body__dot:nth-child(2)::after { bottom: 0; left: 0; animation: wobble1 var(--uib-speed) infinite calc(var(--uib-speed) * -0.15) ease-in-out; }
        .three-body__dot:nth-child(3) { bottom: -5%; left: 0; transform: translateX(116.666%); }
        .three-body__dot:nth-child(3)::after { top: 0; left: 0; animation: wobble2 var(--uib-speed) infinite ease-in-out; }
        @keyframes spin78236 { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes wobble1 { 0%, 100% { transform: translateY(0%) scale(1); opacity: 1; } 50% { transform: translateY(-66%) scale(0.65); opacity: 0.8; } }
        @keyframes wobble2 { 0%, 100% { transform: translateY(0%) scale(1); opacity: 1; } 50% { transform: translateY(66%) scale(0.65); opacity: 0.8; } }

        /* --- ФОРМА --- */
        .admin-box {
            width: 100%; max-width: 600px; background: var(--card-bg);
            padding: 25px; border-radius: 15px; border: 1px solid #222; margin-bottom: 30px;
            position: relative;
        }

        input, textarea {
            width: 100%; background: #000; border: 1px solid #333;
            color: var(--neon-green); padding: 10px; margin-bottom: 10px;
            border-radius: 5px; outline: none; box-sizing: border-box;
        }

        .btn-submit {
            width: 100%; padding: 12px; background: transparent;
            border: 1px solid var(--neon-green); color: var(--neon-green);
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn-submit:hover { background: var(--neon-green); color: #000; }

        /* GitHub Repos Section */
        #githubRepos {
            width: 100%; max-width: 1200px; display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }

        .repo-card {
            background: var(--card-bg); border: 1px solid #222;
            border-radius: 10px; padding: 15px; color: #ddd;
        }
        .repo-card h3 { margin: 0 0 8px; color: var(--neon-green); font-size: 18px; }
        .repo-card p { font-size: 13px; color: #aaa; margin: 0 0 10px; }

        /* === НОВЫЙ СТИЛЬ КНОПКИ ON SITE === */
        .on-site-btn {
            padding: 1.3em 3em;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            font-weight: 500;
            color: #000;
            background-color: #fff;
            border: none;
            border-radius: 45px;
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease 0s;
            cursor: pointer;
            outline: none;
            margin-top: 10px;
            margin-right: 8px;
            display: inline-block;
        }

        .on-site-btn:hover {
            background-color: #23c483;
            box-shadow: 0px 15px 20px rgba(46, 229, 157, 0.4);
            color: #fff;
            transform: translateY(-7px);
        }

        .on-site-btn:active {
            transform: translateY(-1px);
        }

        /* Стиль для кнопки GitHub (в репо-карточках) */
        .repo-link {
            padding: 1.3em 3em;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            font-weight: 500;
            color: #fff;
            background-color: #111;
            border: 1px solid var(--neon-green);
            border-radius: 45px;
            transition: all 0.3s;
            cursor: pointer;
            outline: none;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }
        .repo-link:hover {
            background-color: var(--neon-green);
            color: #000;
            transform: translateY(-3px);
        }

        /* --- ГРИД --- */
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px; width: 100%; max-width: 1200px;
        }

        .card { background: var(--card-bg); border-radius: 12px; border: 1px solid #222; overflow: hidden; cursor: grab; }
        .card:active { cursor: grabbing; }
        .preview-img { width: 100%; height: 180px; object-fit: cover; pointer-events: none; }
        .file-tree { padding: 15px; background: #0c0c0c; font-family: monospace; font-size: 12px; }
        .tree-item { margin-left: 10px; color: #888; }
        .tree-item::before { content: "└ "; color: var(--neon-green); }
        .card-info { padding: 15px; border-top: 1px solid #222; }

        /* Кнопка GitHub */
        .github-button {
            position: relative;
            display: inline-block;
            background: linear-gradient(to bottom, #0b2a1b, #005522);
            color: white;
            font-family: "Segoe UI", sans-serif;
            font-weight: bold;
            font-size: 18px;
            border: none;
            border-radius: 30px;
            padding: 14px 28px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 100, 0, 0.3);
            transition: all 0.3s ease-in-out;
            margin-top: 15px;
        }
        .github-button:hover {
            background: linear-gradient(to bottom, #00ff66, #00aa44);
            color: #000;
            transform: translateY(-2px);
        }
        .github-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* === 404 PAGE STYLES === */
        body.error-page {
            margin: 0;
            padding: 0;
            background-color: #0a0a0a;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .error-content {
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .number-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 250px;
            font-weight: bold;
            line-height: 1;
            margin-bottom: 20px;
            gap: 10px;
        }

        .number {
            color: #00ff66; /* Зелёный вместо серого */
        }

        .bird-zero {
            width: 220px;
            height: 220px;
            object-fit: cover;
            filter: grayscale(20%) hue-rotate(100deg) brightness(1.2);
            box-shadow: 0 0 50px rgba(0, 255, 102, 0.3);
        }

        .main-text {
            font-size: 40px;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 10px;
            color: var(--neon-green);
            text-shadow: 0 0 15px rgba(0, 255, 102, 0.5);
        }

        .sub-text {
            font-size: 18px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 40px;
        }

        .white-btn {
            background-color: var(--neon-green);
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
        }

        .white-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 102, 0.6);
        }

        .bg-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0,255,102,0.05) 0%, rgba(0,0,0,0.8) 100%);
            z-index: 1;
            pointer-events: none;
        }

        .hidden { display: none; }
    </style>
</head>
<body id="mainBody">

    <div id="loader-overlay">
        <div class="three-body">
            <div class="three-body__dot"></div>
            <div class="three-body__dot"></div>
            <div class="three-body__dot"></div>
        </div>
    </div>

    <h2 style="letter-spacing: 5px;">PROJECT_MANAGER_V2</h2>

    <div class="admin-box">
        <input type="text" id="siteUrl" placeholder="Ссылка на сайт (URL)">
        <textarea id="desc" placeholder="Описание проекта..."></textarea>
        <textarea id="treeData" placeholder="Дерево файлов (через запятую или с новой строки)" rows="3"></textarea>
        <button class="btn-submit" onclick="addProject()">ДОБАВИТЬ В БАЗУ</button>
        <button class="github-button" onclick="loadGitHubRepos()">ЗАГРУЗИТЬ МОИ РЕПОЗИТОРИИ</button>
    </div>

    <!-- GitHub Repos Section -->
    <div id="githubRepos"></div>

    <!-- Local Projects Grid -->
    <div class="grid" id="projectGrid"></div>

    <!-- 404 Error Page (initially hidden) -->
    <div id="error404" class="hidden">
        <div class="bg-overlay"></div>
        <div class="error-content">
            <div class="number-wrapper">
                <span class="number">4</span>
                <img src="404.jpg" alt="0" class="bird-zero">
                <span class="number">4</span>
            </div>
            <div class="main-text">С трудом верится</div>
            <div class="sub-text">Что такой страницы не существует</div>
            <a href="javascript:showMainPage()" class="white-btn">Вернуться на главную</a>
        </div>
    </div>

<script>
    const grid = document.getElementById('projectGrid');
    const githubReposContainer = document.getElementById('githubRepos');
    const error404 = document.getElementById('error404');
    const mainBody = document.getElementById('mainBody');

    // Показать 404
    function show404() {
        mainBody.classList.add('hidden');
        error404.classList.remove('hidden');
        document.body.classList.add('error-page');
    }

    // Вернуться на главную
    function showMainPage() {
        error404.classList.add('hidden');
        mainBody.classList.remove('hidden');
        document.body.classList.remove('error-page');
    }

    function runLoader() {
        const loader = document.getElementById('loader-overlay');
        loader.style.display = 'flex';
        setTimeout(() => loader.style.display = 'none', 1600);
    }

    window.onload = () => {
        runLoader();
        loadProjects();
        // loadGitHubRepos(); // Можно раскомментировать, если хочешь автоматически загружать
    };

    function addProject() {
        const link = document.getElementById('siteUrl').value.trim();
        const desc = document.getElementById('desc').value.trim();
        const tree = document.getElementById('treeData').value.split(/[\n,]+/).map(t => t.trim()).filter(t => t);

        if (!link) return alert("Укажите ссылку!");
        if (JSON.parse(localStorage.getItem('dragLib') || '[]').some(p => p.link === link)) {
            alert("Проект уже существует!");
            return;
        }

        const project = { id: Date.now(), img: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='180' style='background:%23111'%3E%3Ctext x='50%25' y='50%25' fill='%2300ff66' font-size='20' text-anchor='middle' dominant-baseline='middle'%3ENo preview%3C/text%3E%3C/svg%3E", link, desc, tree };
        const projects = JSON.parse(localStorage.getItem('dragLib') || '[]');
        projects.push(project);
        localStorage.setItem('dragLib', JSON.stringify(projects));
        loadProjects();
    }

    function renderCard(p) {
        const card = document.createElement('div');
        card.className = 'card';
        card.draggable = true;
        card.dataset.id = p.id;
        const treeHtml = p.tree.map(item => `<div class="tree-item">${item}</div>`).join('');
        card.innerHTML = `
            <img src="${p.img}" class="preview-img">
            <div class="file-tree">${treeHtml || 'no_files_logged'}</div>
            <div class="card-info">
                <p style="font-size:13px; color:#aaa; margin:0;">${p.desc}</p>
                <a href="${p.link}" target="_blank" style="color:var(--neon-green); text-decoration:underline;">On site</a>
                <button onclick="deleteProject(${p.id})" style="background:none; border:none; color:var(--neon-red); cursor:pointer; font-size:10px; float:right;">DELETE</button>
            </div>
        `;
        grid.appendChild(card);
    }

    function loadProjects() {
        grid.innerHTML = '';
        JSON.parse(localStorage.getItem('dragLib') || '[]').forEach(renderCard);
    }

    function deleteProject(id) {
        let projects = JSON.parse(localStorage.getItem('dragLib') || '[]');
        projects = projects.filter(p => p.id !== id);
        localStorage.setItem('dragLib', JSON.stringify(projects));
        loadProjects();
    }

    // === GitHub API ===
    async function loadGitHubRepos() {
        githubReposContainer.innerHTML = '<p style="color:var(--neon-green);">Загрузка репозиториев...</p>';
        try {
            const res = await fetch('https://api.github.com/users/Xsaz587/repos?sort=updated&per_page=10');
            if (!res.ok) throw new Error('Не удалось загрузить репозитории');
            const repos = await res.json();
            githubReposContainer.innerHTML = '';
            if (repos.length === 0) {
                githubReposContainer.innerHTML = '<p style="color:var(--neon-red);">Нет публичных репозиториев</p>';
                return;
            }
            repos.forEach(repo => {
                const card = document.createElement('div');
                card.className = 'repo-card';

                // Кнопки
                let buttonsHtml = '';

                // Кнопка GitHub — всегда
                buttonsHtml += `<a href="${repo.html_url}" target="_blank" class="repo-link">REPO</a>`;

                // Кнопка "ON SITE" — только если есть homepage
                if (repo.homepage && repo.homepage.trim() !== '') {
                    buttonsHtml += `<a href="${repo.homepage}" target="_blank" class="on-site-btn">ON SITE</a>`;
                }

                card.innerHTML = `
                    <h3>${repo.name}</h3>
                    <p>${repo.description || 'Без описания'}</p>
                    <div style="margin-top: 15px;">
                        ${buttonsHtml}
                    </div>
                `;
                githubReposContainer.appendChild(card);
            });
        } catch (err) {
            console.error(err);
            githubReposContainer.innerHTML = `<p style="color:var(--neon-red);">Ошибка: ${err.message}</p>`;
        }
    }

    // Пример проверки на несуществующий проект (например, по URL-параметру)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('project') && !localStorage.getItem('dragLib')?.includes(urlParams.get('project'))) {
        show404();
    }
</script>

</body>
</html>
